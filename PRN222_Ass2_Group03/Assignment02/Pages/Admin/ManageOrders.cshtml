@page
@model Assignment02.Pages.Admin.ManageOrdersModel
@{
    ViewData["Title"] = "Manage Orders";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="page-header">
                <h1 class="page-title">
                    <i class="fas fa-shopping-cart"></i>
                    Manage Orders
                </h1>
                <p class="page-subtitle">Manage all customer orders</p>
            </div>

            <!-- Filter Section -->
            <div class="filter-section">
                <div class="row">
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="statusFilter">Filter by Status:</label>
                            <select id="statusFilter" class="form-control" onchange="filterOrders()">
                                <option value="all">All Status</option>
                                <option value="Pending">Pending</option>
                                <option value="Confirmed">Confirmed</option>
                                <option value="Processing">Processing</option>
                                <option value="Shipped">Shipped</option>
                                <option value="Delivered">Delivered</option>
                                <option value="Cancelled">Cancelled</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="paymentFilter">Filter by Payment:</label>
                            <select id="paymentFilter" class="form-control" onchange="filterOrders()">
                                <option value="all">All Payment Status</option>
                                <option value="Pending">Pending</option>
                                <option value="Paid">Paid</option>
                                <option value="Failed">Failed</option>
                                <option value="Refunded">Refunded</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="dateFrom">From Date:</label>
                            <input type="date" id="dateFrom" class="form-control" onchange="filterOrders()">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="dateTo">To Date:</label>
                            <input type="date" id="dateTo" class="form-control" onchange="filterOrders()">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Orders Table -->
            <div class="orders-table-container">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Vehicle</th>
                                <th>Dealer</th>
                                <th>Status</th>
                                <th>Payment Status</th>
                                <th>Total Amount</th>
                                <th>Order Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model.Orders.Any())
                            {
                                @foreach (var order in Model.Orders)
                                {
                                    <tr>
                                        <td>
                                            <a href="/Orders/Details/@order.Id" class="order-link">
                                                @order.Id.ToString().Substring(0, 8)...
                                            </a>
                                        </td>
                                        <td>@order.CustomerName</td>
                                        <td>@order.VehicleName</td>
                                        <td>@order.DealerName</td>
                                        <td>
                                            <span class="badge status-@(order.Status?.ToLower())">
                                                @order.Status
                                            </span>
                                        </td>
                                        <td>
                                            <span class="badge payment-@(order.PaymentStatus?.ToLower())">
                                                @order.PaymentStatus
                                            </span>
                                        </td>
                                        <td>@order.TotalAmount.ToString("C")</td>
                                        <td>@(order.CreatedAt?.ToString("MM/dd/yyyy") ?? "N/A")</td>
                                        <td>
                                            <div class="btn-group" role="group">
                                                <a href="/Orders/Details/@order.Id" class="btn btn-sm btn-outline-primary">
                                                    <i class="fas fa-eye"></i> View
                                                </a>
                                                @if (order.Status == "Pending")
                                                {
                                                    <button class="btn btn-sm btn-outline-success" onclick="updateOrderStatus('@order.Id', 'Confirmed')">
                                                        <i class="fas fa-check"></i> Confirm
                                                    </button>
                                                }
                                                @if (order.Status == "Confirmed")
                                                {
                                                    <button class="btn btn-sm btn-outline-warning" onclick="updateOrderStatus('@order.Id', 'Processing')">
                                                        <i class="fas fa-cog"></i> Process
                                                    </button>
                                                }
                                                @if (order.Status == "Processing")
                                                {
                                                    <button class="btn btn-sm btn-outline-info" onclick="updateOrderStatus('@order.Id', 'Shipped')">
                                                        <i class="fas fa-shipping-fast"></i> Ship
                                                    </button>
                                                }
                                                @if (order.Status == "Shipped")
                                                {
                                                    <button class="btn btn-sm btn-outline-success" onclick="updateOrderStatus('@order.Id', 'Delivered')">
                                                        <i class="fas fa-check-circle"></i> Deliver
                                                    </button>
                                                }
                                            </div>
                                        </td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="9" class="text-center">
                                        <div class="no-orders">
                                            <i class="fas fa-shopping-cart fa-3x"></i>
                                            <h4>No orders found</h4>
                                            <p>There are no orders matching your criteria.</p>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function filterOrders() {
            const status = document.getElementById('statusFilter').value;
            const payment = document.getElementById('paymentFilter').value;
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            
            // Build query string
            const params = new URLSearchParams();
            if (status !== 'all') params.append('status', status);
            if (payment !== 'all') params.append('paymentStatus', payment);
            if (dateFrom) params.append('fromDate', dateFrom);
            if (dateTo) params.append('toDate', dateTo);
            
            // Redirect with filters
            window.location.href = '/Admin/ManageOrders?' + params.toString();
        }

        function updateOrderStatus(orderId, newStatus) {
            if (confirm(`Are you sure you want to update this order status to ${newStatus}?`)) {
                // Create form and submit
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/Admin/ManageOrders?handler=UpdateStatus';
                
                const orderIdInput = document.createElement('input');
                orderIdInput.type = 'hidden';
                orderIdInput.name = 'orderId';
                orderIdInput.value = orderId;
                
                const statusInput = document.createElement('input');
                statusInput.type = 'hidden';
                statusInput.name = 'newStatus';
                statusInput.value = newStatus;
                
                form.appendChild(orderIdInput);
                form.appendChild(statusInput);
                document.body.appendChild(form);
                form.submit();
            }
        }
    </script>
}

<style>
    .page-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem;
        border-radius: 15px;
        margin-bottom: 2rem;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }

    .page-title {
        font-size: 2.5rem;
        font-weight: 700;
        margin: 0;
    }

    .page-subtitle {
        font-size: 1.1rem;
        opacity: 0.9;
        margin: 0.5rem 0 0 0;
    }

    .filter-section {
        background: white;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        margin-bottom: 2rem;
    }

    .orders-table-container {
        background: white;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        overflow: hidden;
    }

    .table {
        margin: 0;
    }

    .table th {
        background: #343a40;
        color: white;
        border: none;
        font-weight: 600;
        padding: 1rem;
    }

    .table td {
        padding: 1rem;
        vertical-align: middle;
        border-top: 1px solid #dee2e6;
    }

    .order-link {
        color: #007bff;
        text-decoration: none;
        font-weight: 500;
    }

    .order-link:hover {
        color: #0056b3;
        text-decoration: underline;
    }

    .badge {
        font-size: 0.8rem;
        padding: 0.5rem 0.8rem;
        border-radius: 20px;
    }

    .status-pending { background-color: #ffc107; color: #000; }
    .status-confirmed { background-color: #17a2b8; color: #fff; }
    .status-processing { background-color: #fd7e14; color: #fff; }
    .status-shipped { background-color: #6f42c1; color: #fff; }
    .status-delivered { background-color: #28a745; color: #fff; }
    .status-cancelled { background-color: #dc3545; color: #fff; }

    .payment-pending { background-color: #ffc107; color: #000; }
    .payment-paid { background-color: #28a745; color: #fff; }
    .payment-failed { background-color: #dc3545; color: #fff; }
    .payment-refunded { background-color: #6c757d; color: #fff; }

    .no-orders {
        padding: 3rem;
        text-align: center;
        color: #6c757d;
    }

    .no-orders i {
        margin-bottom: 1rem;
        opacity: 0.5;
    }

    .btn-group .btn {
        margin-right: 0.25rem;
    }

    .btn-group .btn:last-child {
        margin-right: 0;
    }
</style>
